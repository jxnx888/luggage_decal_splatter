<!DOCTYPE html>
<html lang="en">
<head>
	<title>three.js webgl - BendModifier with three.js 81</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<style>
		body {
			color: #000;
			font-family:Monospace;
			font-size:13px;
			text-align:center;
			font-weight: bold;

			background-color: #fff;
			margin: 0px;
			overflow: hidden;
		}

		#info {
			color:#000;
			position: absolute;
			top: 0px; width: 100%;
			padding: 5px;

		}

		a {
			color: red;
		}
	</style>
</head>

<body>
<div id="container"></div>
<div id="info">
	<a href="http://threejs.org" target="_blank">three.js</a> - BendModifier example with three.js 81</br>
	Click the mouse on the plane
</div>

<script src="../js/three.js"></script>
<script src="../js/others/TrackballControls.js"></script>
<script src="../js/others/Detector.js"></script>
<script src="../js/others/BendModifierMy.js"></script>


<script>

	if ( ! Detector.webgl ) Detector.addGetWebGLMessage();

	var container, stats;

	var camera, controls, scene, renderer;

	var mouse = new THREE.Vector2();
	var modifier = new THREE.BendModifier();
	var Plane;

	init();
	animate();

	function init() {

		// camera

		AddCamera(0, 0, 2000);

		scene = new THREE.Scene();

		// lights

		light = new THREE.DirectionalLight( 0xffffff );
		light.position.set( 0, 100, 200 );
		scene.add( light );

		light = new THREE.DirectionalLight( 0xffffff );
		light.position.set( 0, -100, -200 );
		scene.add( light );

		// renderer

		renderer = new THREE.WebGLRenderer( { antialias: true } );
		renderer.setClearColor( 0xffffff );
		renderer.setSize( window.innerWidth, window.innerHeight );

		container = document.getElementById( 'container' );
		container.appendChild( renderer.domElement );


		window.addEventListener( 'resize', onWindowResize, false );
		document.addEventListener( 'mousedown', onDocumentMouseDown, false );

		// world

		var geometry = new THREE.CylinderGeometry( 36, 36, 800, 12, 12, false );
		var material = new THREE.MeshLambertMaterial( { color: 0x33CCFF, wireframe: false } );

		var cylinder = new THREE.Mesh( geometry, material );
		cylinder.position.set( 0, 350, 100 );
		cylinder.rotation.z = Math.PI / 2;


		var direction = new THREE.Vector3( 0, 0, -1 );
		var axis =  new THREE.Vector3( 1, 0, 0 );
		var angle = Math.PI / 2.5;

		modifier.set( direction, axis, angle ).modify( cylinder.geometry );
		scene.add( cylinder );
//////////////////////


		var geometry2 = new THREE.CylinderGeometry( 36, 36, 600, 12, 22, false );
		var material2 = new THREE.MeshPhongMaterial( { color: 0x66FF99, specular: 0x666 } );

		var cylinder2 = new THREE.Mesh( geometry2, material2 );
		cylinder2.position.set( 0, -350, 100 );
		//	cylinder2.rotation.z = Math.PI / 2;


		var direction2 = new THREE.Vector3( -1, 0, 0 );
		var axis2 =  new THREE.Vector3( 0, 0, 1 );
		var angle2 = Math.PI / 2.3;

		modifier.set( direction2, axis2, angle2 ).modify( cylinder2.geometry );
		scene.add( cylinder2 );

////////////////////////

		var loader = new THREE.FontLoader();
		loader.load( '../css/font/other/helvetiker_bold.typeface.json', function ( font ) {
			var textGeo = new THREE.TextGeometry( "Bending Text", {

				font: font,

				size: 200,
				height: 50,
				curveSegments: 12,

				bevelThickness: 2,
				bevelSize: 5,
				bevelEnabled: true

			} );

			textGeo.computeBoundingBox();
			var text2 = textGeo.clone()
			var centerOffset = - 0.5 * ( textGeo.boundingBox.max.x - textGeo.boundingBox.min.x );

			var textMaterial = new THREE.MeshPhongMaterial( { color: 0xff0000, specular: 0xffffff } );

			var mesh = new THREE.Mesh( textGeo, textMaterial );
			mesh.position.x = centerOffset;

			/*var dir = new THREE.Vector3( 0, -1, 0 );
			var ax =  new THREE.Vector3( 0, 0, 1 );
			var ang = Math.PI / 4;
			modifier.set( dir, ax, ang ).modify(textGeo);*/
			var direction = new THREE.Vector3( 0, 0, -1 );
			var axis =  new THREE.Vector3( 0, 1, 0 );
			var angle = Math.PI / 2.5;
			modifier.set( direction, axis, angle ).modify( textGeo);
			scene.add( mesh );
			///////////////////
			var textMaterial = new THREE.MeshPhongMaterial( { color: 0x0000ff, specular: 0x004400 } );
			var mesh2 = new THREE.Mesh( text2, textMaterial );

			mesh2.position.x = centerOffset;
			mesh2.position.y = -centerOffset/2;
			var dir = new THREE.Vector3( 0, 0, 1 );
			var ax =  new THREE.Vector3( 1, 1, 0 );
			var ang = Math.PI / 3;
			modifier.set( dir, ax, ang ).modify(text2);
			scene.add( mesh2 );
		} );

		// axis
		var axisHelper = new THREE.AxisHelper( 500 );
		this.scene.add( axisHelper );

	}


	function onDocumentMouseDown( event ) {

		var vector = new THREE.Vector3( ( event.clientX / window.innerWidth ) * 2 - 1, - ( event.clientY / window.innerHeight ) * 2 + 1, 0.5 );

		var raycaster = new THREE.Raycaster( camera.position, vector.sub( camera.position ).normalize() );


	}

	function onWindowResize() {

		camera.aspect = window.innerWidth / window.innerHeight;
		renderer.setSize( window.innerWidth, window.innerHeight );

	}

	function animate() {

		requestAnimationFrame(animate);
		render();

	}

	function render() {
		controls.update();
		renderer.render(scene, camera);

	}

	function AddCamera( X, Y, Z ) {

		camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 10000 );
		camera.position.set( X, Y, Z );

		controls = new THREE.TrackballControls( camera, container );
		controls.rotateSpeed = 2;
		controls.noZoom = false;
		controls.zoomSpeed = 1.2;
		controls.staticMoving = true;

	}
	async function loadSTL( thisSTL, obj ) {
		stlGeoFlag = 1;//0 geo; 1 stl
		$( "#loading_data" ).show();
		shootedFlag = false;
		var file;
		switch (thisSTL) {
			case 0:
				file = '../models/stl/ascii/3dPrinting/ring.stl';
				currentShapeType = 5;
				break;
			case 1:
				file = '../models/stl/ascii/3dPrinting/longmao.stl';
				currentShapeType = 5;
				break;
			case 2:
				file = '../models/stl/ascii/3dPrinting/shudi.stl';
				currentShapeType = 7;
				break;
			default:
				file = '../models/stl/ascii/3dPrinting/tyrannosaurusRex.stl';
		}
		var loader = new THREE.STLLoader();
		await loader.load( file, function ( geometry ) {
			currentObj = geometry;

		} );
	}
</script>

</body>
</html>
